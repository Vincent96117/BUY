<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V178-X å˜ç©ºæŒ‡æ®å®˜ V1.8 (æˆ°ä½é–å®šç‰ˆ)</title>
    <style>
        :root { --bg: #0b0e11; --card: #181a20; --ready: #f0b90b; --entry: #f6465d; --hold: #2ebd85; --scan: #474d57; --text: #eaecef; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 10px; }
        .container { max-width: 900px; margin: 0 auto; }
        .control-panel { background: var(--card); padding: 15px; border-radius: 10px; border: 1px solid #333; margin-bottom: 15px; display: flex; gap: 20px; align-items: center; justify-content: space-between; }
        .audio-btn { background: var(--ready); color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 10px; overflow: hidden; }
        th { background: #1e2329; color: #848e9c; padding: 12px 8px; font-size: 12px; text-align: left; }
        td { padding: 12px 8px; border-bottom: 1px solid #2b2f36; }

        /* é–å®šè¡Œï¼šå³ä½¿è®Šå› SCAN ä¹Ÿç¶­æŒé«˜äº®å’Œç½®é ‚ */
        .locked-row { background: rgba(46, 189, 133, 0.08) !important; border-left: 4px solid var(--hold); }
        .unlock-btn { background: #444; color: #ccc; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 10px; margin-left: 5px; }
        
        .status-badge { padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; }
        .READY { background: rgba(240, 185, 11, 0.25); color: var(--ready); border: 1px solid var(--ready); animation: flash 1.5s infinite; }
        .ENTRY { background: rgba(246, 70, 93, 0.35); color: var(--entry); border: 1px solid var(--entry); animation: pulse 0.6s infinite alternate; }
        .SCAN { color: var(--scan); border: 1px solid var(--scan); }
        
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes pulse { 0% { transform: scale(1); } 100% { transform: scale(1.05); } }
        .time-tag { font-size: 10px; color: #888; display: block; margin-top: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div class="control-panel">
        <div style="font-size: 18px; font-weight: bold; color: var(--ready);">V1.8 æˆ°ä½é–å®šç³»çµ±</div>
        <button id="enableAudio" class="audio-btn">ğŸ”Š å•Ÿå‹•æç¤ºéŸ³èˆ‡é–å®šç›£æ§</button>
        <div id="status-info" style="font-size: 12px; color: #848e9c;">å·²é–å®š 0 å€‹æ¨™çš„</div>
    </div>

    <table>
        <thead>
            <tr>
                <th>å¹£ç¨® (USDT)</th>
                <th>è§€å¯Ÿåƒ¹/ç•¶å‰åƒ¹</th>
                <th>ç‡ˆè™Ÿ (é–å®šæ™‚é–“)</th>
                <th>è³‡è²»</th>
                <th>å¼•åŠ›è·é›¢</th>
            </tr>
        </thead>
        <tbody id="list"></tbody>
    </table>
</div>

<script>
    const blacklist = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT", "DOGEUSDT", "ADAUSDT", "TRXUSDT", "AVAXUSDT", "DOTUSDT", "SHIBUSDT", "TONUSDT", "LINKUSDT", "BCHUSDT", "NEARUSDT", "MATICUSDT", "LTCUSDT", "PEPEUSDT", "UNIUSDT", "ICPUSDT", "RENDERUSDT", "APTUSDT", "HBARUSDT", "ARBUSDT", "SUIUSDT"];
    
    let audioEnabled = false;
    let lockedSymbols = {}; // è¨˜æ†¶æ›¾ç¶“ READY/ENTRY çš„å¹£

    document.getElementById('enableAudio').addEventListener('click', function() {
        audioEnabled = !audioEnabled;
        this.innerText = audioEnabled ? "âœ… é–å®šç›£æ§ä¸­" : "ğŸ”Š å•Ÿå‹•æç¤ºéŸ³èˆ‡é–å®šç›£æ§";
        this.style.background = audioEnabled ? "#2ebd85" : "#f0b90b";
    });

    function unlock(symbol) {
        delete lockedSymbols[symbol];
        update();
    }

    async function getHigh(symbol) {
        try {
            const r = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=4h&limit=42`);
            const d = await r.json();
            return Math.max(...d.map(k => parseFloat(k[2])));
        } catch(e) { return 0; }
    }

    async function update() {
        try {
            const tickerR = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
            const all = await tickerR.json();
            const candidates = all.filter(c => c.symbol.endsWith('USDT') && !blacklist.includes(c.symbol) && parseFloat(c.quoteVolume) > 30000000);

            let coinData = [];
            for (let coin of candidates.slice(0, 35)) {
                const high7D = await getHigh(coin.symbol);
                const curPrice = parseFloat(coin.lastPrice);
                const dist = ((high7D - curPrice) / curPrice * 100);
                const fundR = await fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${coin.symbol}`);
                const fundD = await fundR.json();
                const fund = (parseFloat(fundD.lastFundingRate) * 100).toFixed(4);

                let stCmd = "SCAN";
                if (curPrice >= high7D * 1.002 && fund <= -0.03) stCmd = "ENTRY";
                else if (dist < 1.5 && dist > -0.5 && fund <= -0.03) stCmd = "READY";

                // æ ¸å¿ƒé–å®šé‚è¼¯
                if (stCmd === "READY" || stCmd === "ENTRY") {
                    if (!lockedSymbols[coin.symbol]) {
                        lockedSymbols[coin.symbol] = { time: new Date().toLocaleTimeString(), status: stCmd };
                    } else {
                        lockedSymbols[coin.symbol].status = stCmd; // æ›´æ–°ç‹€æ…‹
                    }
                }

                coinData.push({ ...coin, high7D, curPrice, dist, fund, stCmd });
            }

            // æ’åºï¼šé–å®šçš„æ’æœ€ä¸Šé¢ï¼Œå‰©é¤˜çš„æŒ‰è·é›¢æ’åº
            coinData.sort((a, b) => {
                const aLocked = lockedSymbols[a.symbol] ? 1 : 0;
                const bLocked = lockedSymbols[b.symbol] ? 1 : 0;
                if (aLocked !== bLocked) return bLocked - aLocked;
                return a.dist - b.dist;
            });

            const listBody = document.getElementById('list');
            listBody.innerHTML = '';
            document.getElementById('status-info').innerText = `å·²é–å®š ${Object.keys(lockedSymbols).length} å€‹æ¨™çš„`;

            for (let coin of coinData) {
                const isLocked = lockedSymbols[coin.symbol];
                const displayStatus = isLocked ? lockedSymbols[coin.symbol].status : coin.stCmd;
                const row = `
                    <tr class="${isLocked ? 'locked-row' : ''}">
                        <td>
                            <div class="symbol-name">${coin.symbol.replace('USDT','')}</div>
                            <div style="font-size:10px; color:#666">7D High: ${coin.high7D}</div>
                        </td>
                        <td style="font-family:monospace">${coin.curPrice}</td>
                        <td>
                            <span class="status-badge ${displayStatus}">${displayStatus}</span>
                            ${isLocked ? `<span class="time-tag">â± ${lockedSymbols[coin.symbol].time} <button class="unlock-btn" onclick="unlock('${coin.symbol}')">è§£é™¤é–å®š</button></span>` : ''}
                        </td>
                        <td class="${Math.abs(coin.fund)>=0.05?'fund-warn':''}">${coin.fund}%</td>
                        <td style="font-weight:bold; color:${coin.dist < 1.5 ? 'var(--ready)' : '#888'}">${coin.dist.toFixed(2)}%</td>
                    </tr>
                `;
                listBody.insertAdjacentHTML('beforeend', row);
            }
        } catch (e) {}
    }

    setInterval(update, 30000);
    update();
</script>
</body>
</html>
